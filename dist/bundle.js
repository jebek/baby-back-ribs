!function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)t.d(n,s,function(t){return e[t]}.bind(null,s));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,i){var n=i(1);"string"==typeof n&&(n=[[e.i,n,""]]),i(3)(n,{insert:"head",singleton:!1}),n.locals&&(e.exports=n.locals)},function(e,t,i){(e.exports=i(2)(!1)).push([e.i,"body{margin:0;overflow:hidden}.button{position:absolute;top:30%;left:50%;transform:translate(-50%, -50%);border-radius:5px;border:2px solid black;padding:5px 20px;cursor:pointer}.hidden{display:none}.instructions{padding:20px;position:absolute}\n",""])},function(e){"use strict";function t(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var s=function(e){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(t);return"/*# ".concat(i," */")}(n),o=n.sources.map(function(e){return"/*# sourceURL=".concat(n.sourceRoot).concat(e," */")});return[i].concat(o).concat([s]).join("\n")}return[i].join("\n")}e.exports=function(e){var i=[];return i.toString=function(){return this.map(function(i){var n=t(i,e);return i[2]?"@media ".concat(i[2],"{").concat(n,"}"):n}).join("")},i.i=function(e,t){"string"==typeof e&&(e=[[null,e,""]]);for(var n,s={},o=0;o<this.length;o++)null!=(n=this[o][0])&&(s[n]=!0);for(var r,a=0;a<e.length;a++)null!=(r=e[a])[0]&&s[r[0]]||(t&&!r[2]?r[2]=t:t&&(r[2]="(".concat(r[2],") and (").concat(t,")")),i.push(r))},i}},function(e,t,i){"use strict";function n(e,t){for(var i=[],n={},s=0;s<e.length;s++){var o=e[s],r=t.base?o[0]+t.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function s(e,t){for(var i=0;i<e.length;i++){var n=e[i],s=c[n.id],o=0;if(s){for(s.refs++;o<s.parts.length;o++)s.parts[o](n.parts[o]);for(;o<n.parts.length;o++)s.parts.push(h(n.parts[o],t))}else{for(var r=[];o<n.parts.length;o++)r.push(h(n.parts[o],t));c[n.id]={id:n.id,refs:1,parts:r}}}}function o(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var n=i.nc;n&&(e.attributes.nonce=n)}if(Object.keys(e.attributes).forEach(function(i){t.setAttribute(i,e.attributes[i])}),"function"==typeof e.insert)e.insert(t);else{var s=u(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}function r(e,t,i,n){var s=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=p(t,s);else{var o=document.createTextNode(s),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}function a(e,t,i){var n=i.css,s=i.media,o=i.sourceMap;if(s&&e.setAttribute("media",s),o&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function h(e,t){var i,n,s;if(t.singleton){var h=m++;i=d||(d=o(t)),n=r.bind(null,i,h,!1),s=r.bind(null,i,h,!0)}else i=o(t),n=a.bind(null,i,t),s=function(){!function(e){null!==e.parentNode&&e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else s()}}var c={},l=function(){var e;return function(){return void 0===e&&(e=!(!(window&&document&&document.all)||window.atob)),e}}(),u=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),p=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}(),d=null,m=0;e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=l());var i=n(e,t);return s(i,t),function(e){for(var o=[],r=0;r<i.length;r++){var a=i[r],h=c[a.id];h&&(h.refs--,o.push(h))}e&&s(n(e,t),t);for(var l,u=0;u<o.length;u++)if(0===(l=o[u]).refs){for(var p=0;p<l.parts.length;p++)l.parts[p]();delete c[l.id]}}}},function(e,t,i){"use strict";function n(e){THREE.Curve.call(this),this.scale=void 0===e?1:e}i.r(t),i(0);class s extends THREE.Group{constructor(e,t,i){super(),this.mesh=new THREE.Mesh(e,t),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;let n=new THREE.CylinderGeometry(2.1,2.1,.2,32),s=new THREE.MeshBasicMaterial({color:8772422}),o=new THREE.Mesh(n,s);o.position.y=.1;let r=new THREE.CylinderGeometry(2.1,2.1,.2,32),a=new THREE.MeshBasicMaterial({color:15417401}),h=new THREE.Mesh(r,a);h.position.y=-.1;let c=new THREE.CylinderGeometry(2.1,2.1,.2,32),l=new THREE.MeshBasicMaterial({color:12347450}),u=new THREE.Mesh(c,l);u.position.y=-.3,this.position.set(0,.5,i),this.add(this.mesh,o,h,u)}}var o=class{constructor(e,t,i,n,s){this.heroContainer=e,this.hero=t,this.pathLength=s.pathLength,this.group=new THREE.Group,this.group.position.x=i?i.x:0,this.group.position.y=i?i.y:0,this.group.position.z=-this.pathLength/2,this.turn=n,this.tacoDistance=s.tacoDistance,this.burgerDistances=s.burgerDistances,this.planeDistances=s.planeDistances,this.paused=!0,this.pathSegmentsLength=1}_createWall(e){const t=new THREE.BoxGeometry(20,20,2,2);let i=new THREE.MeshLambertMaterial({color:16753920,flatShading:THREE.FlatShading});this.plusOrMinus=.5>Math.random()?-1:1,this.direction=0<this.plusOrMinus?"left":"right";let n=new class{constructor(e,t,i,n){this.mesh=new THREE.Mesh(e,t),this.mesh.position.set(0,10,n),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.rotation.y=i}}(t,i,2*this.plusOrMinus,e);this.group.add(n.mesh)}_createBack(e){const t=new THREE.PolyhedronBufferGeometry([-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,1,1],[2,1,0,0,3,2,0,4,7,7,3,0,0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,6,6,7,4],2,2);let i=new THREE.MeshLambertMaterial({color:15702062,flatShading:THREE.FlatShading}),n=new s(t,i,50*e);this.group.add(n)}_createPlane(e){let t=new THREE.BoxGeometry(10,50,1),i=new THREE.MeshLambertMaterial({color:4459621}),n=new THREE.Mesh(t,i);n.position.z=50*e,n.rotation.x=-1.57,n.receiveShadow=!0,this.group.add(n)}init(){0!==this.planeDistances.length&&(this.group.remove(this.plane),this.planeDistances.forEach(e=>{this._createPlane(e)}),this.pathSegmentsLength=this.planeDistances.length),this._createWall(this.tacoDistance),this.burgerDistances.forEach(e=>{this._createBack(e)})}initPlane(){let e=new THREE.BoxGeometry(10,1e3,1),t=new THREE.MeshLambertMaterial({color:4459621});this.plane=new THREE.Mesh(e,t),this.plane.rotation.x=-1.57,this.plane.receiveShadow=!0,this.group.add(this.plane)}detectWall(){let e=this.walls.map(e=>e.mesh),t=new THREE.Raycaster(this.hero.mesh.position,new THREE.Vector3(0,0,-1)).intersectObjects(e);if(0<t.length&&2>t[0].distance)return!this.hero.spinning||(this.turn(),!1)}addScore(e){document.querySelector("#score").innerHTML=this.hero.score+=e}detectCollisions(){let e=new THREE.Raycaster(this.hero.mesh.position,new THREE.Vector3(0,-1,0)),t=new THREE.Raycaster(this.hero.mesh.position,new THREE.Vector3(0,0,-1)),i=this.group.children.slice(this.pathSegmentsLength).map(e=>void 0===e.mesh?e:e.mesh),n=e.intersectObjects(i),s=t.intersectObjects(i),o=this.group.children.slice(0,this.pathSegmentsLength),r=e.intersectObjects(o);if(0<r.length&&2>r[0].distance?(this.hero.spinAvailable=!0,this.heroContainer.position.y=r[0].point.y+.1):1.8>=this.hero.mesh.position.y&&(this.heroContainer.position.y-=.5),0<n.length&&2>n[0].distance)return this.hero.jump(),this.hero.spinAvailable=!0,this.addScore(5),!1;if(0<s.length&&3.5>s[0].distance){return!("BoxGeometry"===s[0].object.geometry.type)||!(this.hero.spinning&&this.direction===this.hero.spinDirection)||(this.turn(),this.addScore(10),this.hero.spinAvailable=!0,!1)}return!1}pauseGame(){this.paused=!0}playGame(){this.paused=!1}};n.prototype=Object.create(THREE.Curve.prototype),n.prototype.constructor=n,n.prototype.getPoint=function(e){var t=Math.sin(8*Math.PI*e);return new THREE.Vector3(2*e-1,t,0).multiplyScalar(this.scale)};class r extends THREE.Group{constructor(){super(),this.path=new n(10),this.geometry=new THREE.TubeGeometry(this.path,20,2,8,!1),this.material=new THREE.MeshStandardMaterial({color:14932681}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.geometry2=new THREE.BoxGeometry(25,10,10),this.material2=new THREE.MeshStandardMaterial({color:9109504}),this.mesh2=new THREE.Mesh(this.geometry2,this.material2),this.mesh2.position.set(0,-1,10),this.light=new THREE.SpotLight(16777215,1.3,300,.07),this.light.position.set(0,50,200),this.light.target=this.mesh2,this.position.set(0,50,-400),this.add(this.mesh,this.mesh2,this.light)}}class a extends THREE.Group{constructor(){super();const e=new THREE.SphereBufferGeometry(500,32,32),t=new THREE.ShaderMaterial({uniforms:{t:{type:"c",value:new THREE.Color(2700386)},b:{type:"c",value:new THREE.Color(3809117)}},vertexShader:"\n          varying vec3 v;\n\n          void main() {\n\n            vec4 w = modelMatrix * vec4( position, 1.0 );\n            v = w.xyz;\n    \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n          }\n        ",fragmentShader:"\n          uniform vec3 t;\n          uniform vec3 b;\n          varying vec3 v;\n\n          void main()\n            {\n              vec3 p = normalize(v.xyz);\n              float f = sin(p.y * 2.0);\n\n              gl_FragColor = vec4(mix(t,b, f ), 1.0);\n            }\n        ",side:THREE.BackSide});this.sky=new THREE.Mesh(e,t),this.add(this.sky)}}let h,c,l,u,p,d,m,f,E,g,y,w,v=[],b=()=>{x();let e="left"===v[0].direction?-20:20,t={x:v[0].group.position.x+e,y:v[0].group.position.y};(w=new o(l,c,t,b,{pathLength:1e3,tacoDistance:-500,burgerDistances:[-6,3,4,5,6,7],planeDistances:[]})).initPlane(),w.init(),v.push(w),p.add(v[1].group);let i={x:t.x-v[0].group.position.x,y:t.y-v[0].group.position.y};c.changeDirection(v[0].direction,i),setTimeout(()=>{p.remove(v[0].group),v.shift(),v[0].playGame()},300)},T=()=>{g=window.localStorage.getItem("iwmbbr"),document.querySelector("#score").innerHTML=0,document.querySelector("#hi-score").innerHTML=g||0,c.score=0},R=()=>{let e=new THREE.OctahedronGeometry(1.5);e.scale(.7,1,.7);let t=new THREE.MeshLambertMaterial({color:15277667,flatShading:THREE.FlatShading});c=new class{constructor(e,t){this.mesh=new THREE.Mesh(e,t),this.mesh.castShadow=!0,this.mesh.position.set(0,5,-25),this.mesh.rotation.x=.485,this.gravity=.01,this.bounceValue=0,this.spinValue=0,this.spinDirection="left",this.spinning=!1,this.spinAvailable=!0,this.turn=!1,this.heroBaseY=1.8,this.heroBaseX=0,this.score=0}spin(e){this.spinAvailable&&(this.spinAvailable=!1,this.spinDirection=e,this.spinning=!0,this.mesh.rotation.y+=.4,this.jumping=!0,this.bounceValue=.15)}jump(){this.jumping=!0,this.bounceValue=.2}changeDirection(e,t){this.turn=!0,this.turnDirection=e,this.posDelta=t,this.heroBaseX+=t.x}update(){if(this.spinning&&(10<Math.abs(this.mesh.rotation.y)?(this.mesh.rotation.y=0,this.spinValue=0,this.spinning=!1):"left"===this.spinDirection?this.spinValue=-.4:this.spinValue=.4),this.turn){if(this.mesh.position.x!==this.heroBaseX)return this.heroBaseY+=this.posDelta.y/10,void(this.mesh.position.x+=this.posDelta.x/10);this.turn=!1}this.mesh.position.y<=this.heroBaseY?this.jumping?this.jumping=!1:(this.bounceValue=0,this.spinning=!1):this.bounceValue-=this.gravity,this.mesh.position.y=Math.max(this.mesh.position.y+this.bounceValue,this.heroBaseY),this.mesh.rotation.y+=this.spinValue}}(e,t),(u=new THREE.Object3D).position.set(0,2,-2),c.mesh.add(u),(l=new THREE.Object3D).add(c.mesh),p.add(l),window.addEventListener("keydown",()=>{37===event.keyCode?c.spin("left"):39===event.keyCode&&c.spin("right"),c.mesh.position.y>c.heroBaseY||38===event.keyCode&&c.jump()})},H=()=>{let e;c.update(),v.forEach(t=>{!t.paused&&t.group.position.z<1e3&&(t.group.position.z+=2,e=t.detectCollisions())}),e&&(()=>{let e=document.querySelector("#restart");g=c.score>g?c.score:g,window.localStorage.setItem("iwmbbr",g),v[0].pauseGame(),e.classList.remove("hidden")})(),c.turn?(d.position.y=c.mesh.position.y+3,d.position.z=c.mesh.position.z+40):d.position.y=10,d.position.x=c.mesh.position.x},M=()=>{h.setAnimationLoop(()=>{h.render(p,d),H()})},S=()=>{E=window.innerHeight,f=window.innerWidth,h.setSize(f,E),d.aspect=f/E,d.updateProjectionMatrix()},x=()=>{v[0].pauseGame()},j=()=>{c.spinning=!1,c.jumping=!1,c.spinValue=0,v[0].init(),v[0].playGame(),T(),H(),c.mesh.rotation.z=0};(()=>{let e=document.querySelector("#game");THREE.ImageUtils.crossOrigin="",f=window.innerWidth,E=window.innerHeight,(h=new THREE.WebGLRenderer({canvas:e})).setSize(f,E),h.antialias=!0,h.setClearColor(16777215,1),h.shadowMap.enabled=!0,h.shadowMapSoft=!0,p=new THREE.Scene,(d=new THREE.PerspectiveCamera(45,f/E,1,3e3)).position.set(0,10,0);let t=new THREE.DirectionalLight(16777215,1);t.position.set(-1,1,0);let i=new THREE.HemisphereLight(16758605,3622735,1);i.position.y=500,R(),T(),(()=>{let e=new a;y=new r,p.add(e,y)})(),d.lookAt(c.mesh.position);let n={pathLength:1e3,tacoDistance:-500,burgerDistances:[-3,-4,-5,-6,-7,-8,-9,-10],planeDistances:[0,1,2,3,4,5,6,7,8,9,10]};(w=new o(l,c,{x:0,y:0,z:0},b,n)).initPlane(),v.push(w),(m=new THREE.Group).add(d),p.add(m,t,i,v[0].group),M();let s=document.querySelector("#start"),u=document.querySelector("#restart");s.onclick=()=>{j(),s.classList.add("hidden")},u.onclick=()=>{p.remove(v[0].group),v.shift();let e={x:c.mesh.position.x,y:0,z:0};(w=new o(l,c,e,b,n)).initPlane(),v.push(w),p.add(w.group),j(),u.classList.add("hidden")},window.addEventListener("resize",S),S(),document.body.appendChild(THREE.WEBVR.createButton(h)),h.vr.enabled=!0})()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3N0eWxlcy9zdHlsZS5zYXNzPzU2MDAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3N0eWxlcy9zdHlsZS5zYXNzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL3JpYnMtY29tcG9uZW50LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL2JhY2stY29tcG9uZW50LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL3dhbGwtY29tcG9uZW50LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL3BhdGgtY29tcG9uZW50LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL2JhY2tncm91bmQtY29tcG9uZW50LmpzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9oZXJvLWNvbXBvbmVudC5qcyJdLCJuYW1lcyI6WyJleHBvcnRzIiwiY2FudmFzIl0sIm1hcHBpbmdzIjoiYUFJQSxjQUdBLFFBQ0Esb0JBR0EsWUFDQSxJQUNBLEtBQ0EsWUFVQSxPQU5DLEVBQUQsaUNBR0EsT0FHQSxVQXZCQSxTQTRCQyxFQUFELElBR0EsTUFHQSxvQkFDQSxVQUNBLDJCQUEwQyx1QkFLMUMsZ0JBQ0EsZ0RBQ0EsNENBQXdELGlCQUV4RCxzQ0FBaUQsWUFRakQsa0JBRUEsR0FEQSxjQUNBLGFBQ0EscURBQ0EsMEJBR0EsR0FGQSxPQUNBLG1DQUF5Qyx3QkFDekMsMkRBQWdILGFBQXFCLFVBQXJJLElBQ0EsVUFJQSxnQkFDQSxzQkFDQSxXQUEyQixrQkFD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QSxvRkFDQSx1Q0RMQSxNQUVBLHNCQUVBLHFCQUNBLGVBQ0Esc0JBQ0EsWUFFQSxTQUVBLHVDQUVBLG1CQUNBLGVBQ0ssb0JBQ0wsZ0JBR0EsK0JBSUEsb0JBQ0EsWUE0SEEsT0FFQSxNQUVBLFdBRUEsZUFDQSxVQUNBLG1CQXhPa0IsTUF5T2xCLHNCQUVBLDBCQVhBLEdBVEEsTUFDQSx5Q0FDQSxzQkFDQSx3Q0FDQSxpQkFFQSw4QkFxQkEsR0FJQSxRQUNBLGlDQUNBLG1DQUVBLGdCQUdBLGdDQUdBLE9BQ0Esd0JBQ0EsY0FDQSxPQUlBLE9BRUEscUJBQ0Esb0JBQ0EsZUFDQSxhQUNBLDRCQUdBLE9BQ0Esa0JBR0EsT0FDQSxjQUNBLGFBQ0EsY0FDQSxZQUNBLGdCQUNBLElBRUEsSUFDQSxxQkE1S0EsTUFDQSxzQ0FFQSxnQ0FFQSxvQkFDQSxzQkFFQSwyQkFBc0NDLE9BQUEsS0FDdEMsYUFDQSxlQUNBLDRCQUNBLHVCQUNBLG1CQUVBLG1CQUdBLDZDQUNBLHFCQUdBLDZDQUNBLHVCQUNBLG9EQUNBLGlCQU1BLElBRUEsSUF6Q0EsTUFFQSxZQUNBLFFBRUEsWUFzQ0EsR0FFQSwwQkFyQ0EsSUE0Q0MsRUFBRCxDQUNBLGVBQ0Esa0JBQ0EsMkNBQ0EsMENBR0EsWUFiQSxDQUNBLElBQ0EsSUFDQSxLQVVBLE1BRUEsWUFDQSxXQUVBLG1CQUNBLE9BR0Esd0JBRUEsSUE5REEsSUFnRUMsRUFBRCxpQ0FDQSxxQ0FFQSxlQUNBLElBQ0EsMkJBR0EsZUFFQSxxQkFDQSxVQUVBLE9BQ0Esb0JBQ0EsSUFDQSxNQUdBLG9CQUVBLFlBQ0EsVUFHQSxlQUVBLElBQ0EsMkJBR0Esb0NBQ0EsSUFFQSx1REFDQSxpQkE0RUEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDQpO1xuIiwidmFyIGNvbnRlbnQgPSByZXF1aXJlKFwiISEuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuLi8uLi9ub2RlX21vZHVsZXMvc2Fzcy1sb2FkZXIvZGlzdC9janMuanMhLi9zdHlsZS5zYXNzXCIpO1xuXG5pZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gIGNvbnRlbnQgPSBbW21vZHVsZS5pZCwgY29udGVudCwgJyddXTtcbn1cblxudmFyIG9wdGlvbnMgPSB7fVxuXG5vcHRpb25zLmluc2VydCA9IFwiaGVhZFwiO1xub3B0aW9ucy5zaW5nbGV0b24gPSBmYWxzZTtcblxudmFyIHVwZGF0ZSA9IHJlcXVpcmUoXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzXCIpKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG5pZiAoY29udGVudC5sb2NhbHMpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBjb250ZW50LmxvY2Fscztcbn1cbiIsImV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCIuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzXCIpKGZhbHNlKTtcbi8vIE1vZHVsZVxuZXhwb3J0cy5wdXNoKFttb2R1bGUuaWQsIFwiYm9keXttYXJnaW46MDtvdmVyZmxvdzpoaWRkZW59LmJ1dHRvbntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MzAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwgLTUwJSk7Ym9yZGVyLXJhZGl1czo1cHg7Ym9yZGVyOjJweCBzb2xpZCBibGFjaztwYWRkaW5nOjVweCAyMHB4O2N1cnNvcjpwb2ludGVyfS5oaWRkZW57ZGlzcGxheTpub25lfS5pbnN0cnVjdGlvbnN7cGFkZGluZzoyMHB4O3Bvc2l0aW9uOmFic29sdXRlfVxcblwiLCBcIlwiXSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxuLypcbiAgTUlUIExpY2Vuc2UgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAgQXV0aG9yIFRvYmlhcyBLb3BwZXJzIEBzb2tyYVxuKi9cbi8vIGNzcyBiYXNlIGNvZGUsIGluamVjdGVkIGJ5IHRoZSBjc3MtbG9hZGVyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZnVuYy1uYW1lc1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodXNlU291cmNlTWFwKSB7XG4gIHZhciBsaXN0ID0gW107IC8vIHJldHVybiB0aGUgbGlzdCBvZiBtb2R1bGVzIGFzIGNzcyBzdHJpbmdcblxuICBsaXN0LnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICB2YXIgY29udGVudCA9IGNzc1dpdGhNYXBwaW5nVG9TdHJpbmcoaXRlbSwgdXNlU291cmNlTWFwKTtcblxuICAgICAgaWYgKGl0ZW1bMl0pIHtcbiAgICAgICAgcmV0dXJuIFwiQG1lZGlhIFwiLmNvbmNhdChpdGVtWzJdLCBcIntcIikuY29uY2F0KGNvbnRlbnQsIFwifVwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfSkuam9pbignJyk7XG4gIH07IC8vIGltcG9ydCBhIGxpc3Qgb2YgbW9kdWxlcyBpbnRvIHRoZSBsaXN0XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBmdW5jLW5hbWVzXG5cblxuICBsaXN0LmkgPSBmdW5jdGlvbiAobW9kdWxlcywgbWVkaWFRdWVyeSkge1xuICAgIGlmICh0eXBlb2YgbW9kdWxlcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgbW9kdWxlcyA9IFtbbnVsbCwgbW9kdWxlcywgJyddXTtcbiAgICB9XG5cbiAgICB2YXIgYWxyZWFkeUltcG9ydGVkTW9kdWxlcyA9IHt9O1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWRlc3RydWN0dXJpbmdcbiAgICAgIHZhciBpZCA9IHRoaXNbaV1bMF07XG5cbiAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgIGFscmVhZHlJbXBvcnRlZE1vZHVsZXNbaWRdID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbW9kdWxlcy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHZhciBpdGVtID0gbW9kdWxlc1tfaV07IC8vIHNraXAgYWxyZWFkeSBpbXBvcnRlZCBtb2R1bGVcbiAgICAgIC8vIHRoaXMgaW1wbGVtZW50YXRpb24gaXMgbm90IDEwMCUgcGVyZmVjdCBmb3Igd2VpcmQgbWVkaWEgcXVlcnkgY29tYmluYXRpb25zXG4gICAgICAvLyB3aGVuIGEgbW9kdWxlIGlzIGltcG9ydGVkIG11bHRpcGxlIHRpbWVzIHdpdGggZGlmZmVyZW50IG1lZGlhIHF1ZXJpZXMuXG4gICAgICAvLyBJIGhvcGUgdGhpcyB3aWxsIG5ldmVyIG9jY3VyIChIZXkgdGhpcyB3YXkgd2UgaGF2ZSBzbWFsbGVyIGJ1bmRsZXMpXG5cbiAgICAgIGlmIChpdGVtWzBdID09IG51bGwgfHwgIWFscmVhZHlJbXBvcnRlZE1vZHVsZXNbaXRlbVswXV0pIHtcbiAgICAgICAgaWYgKG1lZGlhUXVlcnkgJiYgIWl0ZW1bMl0pIHtcbiAgICAgICAgICBpdGVtWzJdID0gbWVkaWFRdWVyeTtcbiAgICAgICAgfSBlbHNlIGlmIChtZWRpYVF1ZXJ5KSB7XG4gICAgICAgICAgaXRlbVsyXSA9IFwiKFwiLmNvbmNhdChpdGVtWzJdLCBcIikgYW5kIChcIikuY29uY2F0KG1lZGlhUXVlcnksIFwiKVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxpc3QucHVzaChpdGVtKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIGxpc3Q7XG59O1xuXG5mdW5jdGlvbiBjc3NXaXRoTWFwcGluZ1RvU3RyaW5nKGl0ZW0sIHVzZVNvdXJjZU1hcCkge1xuICB2YXIgY29udGVudCA9IGl0ZW1bMV0gfHwgJyc7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItZGVzdHJ1Y3R1cmluZ1xuXG4gIHZhciBjc3NNYXBwaW5nID0gaXRlbVszXTtcblxuICBpZiAoIWNzc01hcHBpbmcpIHtcbiAgICByZXR1cm4gY29udGVudDtcbiAgfVxuXG4gIGlmICh1c2VTb3VyY2VNYXAgJiYgdHlwZW9mIGJ0b2EgPT09ICdmdW5jdGlvbicpIHtcbiAgICB2YXIgc291cmNlTWFwcGluZyA9IHRvQ29tbWVudChjc3NNYXBwaW5nKTtcbiAgICB2YXIgc291cmNlVVJMcyA9IGNzc01hcHBpbmcuc291cmNlcy5tYXAoZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIFwiLyojIHNvdXJjZVVSTD1cIi5jb25jYXQoY3NzTWFwcGluZy5zb3VyY2VSb290KS5jb25jYXQoc291cmNlLCBcIiAqL1wiKTtcbiAgICB9KTtcbiAgICByZXR1cm4gW2NvbnRlbnRdLmNvbmNhdChzb3VyY2VVUkxzKS5jb25jYXQoW3NvdXJjZU1hcHBpbmddKS5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIHJldHVybiBbY29udGVudF0uam9pbignXFxuJyk7XG59IC8vIEFkYXB0ZWQgZnJvbSBjb252ZXJ0LXNvdXJjZS1tYXAgKE1JVClcblxuXG5mdW5jdGlvbiB0b0NvbW1lbnQoc291cmNlTWFwKSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICB2YXIgYmFzZTY0ID0gYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoc291cmNlTWFwKSkpKTtcbiAgdmFyIGRhdGEgPSBcInNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LFwiLmNvbmNhdChiYXNlNjQpO1xuICByZXR1cm4gXCIvKiMgXCIuY29uY2F0KGRhdGEsIFwiICovXCIpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgc3R5bGVzSW5Eb20gPSB7fTtcblxudmFyIGlzT2xkSUUgPSBmdW5jdGlvbiBpc09sZElFKCkge1xuICB2YXIgbWVtbztcbiAgcmV0dXJuIGZ1bmN0aW9uIG1lbW9yaXplKCkge1xuICAgIGlmICh0eXBlb2YgbWVtbyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vIFRlc3QgZm9yIElFIDw9IDkgYXMgcHJvcG9zZWQgYnkgQnJvd3NlcmhhY2tzXG4gICAgICAvLyBAc2VlIGh0dHA6Ly9icm93c2VyaGFja3MuY29tLyNoYWNrLWU3MWQ4NjkyZjY1MzM0MTczZmVlNzE1YzIyMmNiODA1XG4gICAgICAvLyBUZXN0cyBmb3IgZXhpc3RlbmNlIG9mIHN0YW5kYXJkIGdsb2JhbHMgaXMgdG8gYWxsb3cgc3R5bGUtbG9hZGVyXG4gICAgICAvLyB0byBvcGVyYXRlIGNvcnJlY3RseSBpbnRvIG5vbi1zdGFuZGFyZCBlbnZpcm9ubWVudHNcbiAgICAgIC8vIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9zdHlsZS1sb2FkZXIvaXNzdWVzLzE3N1xuICAgICAgbWVtbyA9IEJvb2xlYW4od2luZG93ICYmIGRvY3VtZW50ICYmIGRvY3VtZW50LmFsbCAmJiAhd2luZG93LmF0b2IpO1xuICAgIH1cblxuICAgIHJldHVybiBtZW1vO1xuICB9O1xufSgpO1xuXG52YXIgZ2V0VGFyZ2V0ID0gZnVuY3Rpb24gZ2V0VGFyZ2V0KCkge1xuICB2YXIgbWVtbyA9IHt9O1xuICByZXR1cm4gZnVuY3Rpb24gbWVtb3JpemUodGFyZ2V0KSB7XG4gICAgaWYgKHR5cGVvZiBtZW1vW3RhcmdldF0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB2YXIgc3R5bGVUYXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhcmdldCk7IC8vIFNwZWNpYWwgY2FzZSB0byByZXR1cm4gaGVhZCBvZiBpZnJhbWUgaW5zdGVhZCBvZiBpZnJhbWUgaXRzZWxmXG5cbiAgICAgIGlmICh3aW5kb3cuSFRNTElGcmFtZUVsZW1lbnQgJiYgc3R5bGVUYXJnZXQgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTElGcmFtZUVsZW1lbnQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBUaGlzIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFjY2VzcyB0byBpZnJhbWUgaXMgYmxvY2tlZFxuICAgICAgICAgIC8vIGR1ZSB0byBjcm9zcy1vcmlnaW4gcmVzdHJpY3Rpb25zXG4gICAgICAgICAgc3R5bGVUYXJnZXQgPSBzdHlsZVRhcmdldC5jb250ZW50RG9jdW1lbnQuaGVhZDtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8vIGlzdGFuYnVsIGlnbm9yZSBuZXh0XG4gICAgICAgICAgc3R5bGVUYXJnZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIG1lbW9bdGFyZ2V0XSA9IHN0eWxlVGFyZ2V0O1xuICAgIH1cblxuICAgIHJldHVybiBtZW1vW3RhcmdldF07XG4gIH07XG59KCk7XG5cbmZ1bmN0aW9uIGxpc3RUb1N0eWxlcyhsaXN0LCBvcHRpb25zKSB7XG4gIHZhciBzdHlsZXMgPSBbXTtcbiAgdmFyIG5ld1N0eWxlcyA9IHt9O1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBpdGVtID0gbGlzdFtpXTtcbiAgICB2YXIgaWQgPSBvcHRpb25zLmJhc2UgPyBpdGVtWzBdICsgb3B0aW9ucy5iYXNlIDogaXRlbVswXTtcbiAgICB2YXIgY3NzID0gaXRlbVsxXTtcbiAgICB2YXIgbWVkaWEgPSBpdGVtWzJdO1xuICAgIHZhciBzb3VyY2VNYXAgPSBpdGVtWzNdO1xuICAgIHZhciBwYXJ0ID0ge1xuICAgICAgY3NzOiBjc3MsXG4gICAgICBtZWRpYTogbWVkaWEsXG4gICAgICBzb3VyY2VNYXA6IHNvdXJjZU1hcFxuICAgIH07XG5cbiAgICBpZiAoIW5ld1N0eWxlc1tpZF0pIHtcbiAgICAgIHN0eWxlcy5wdXNoKG5ld1N0eWxlc1tpZF0gPSB7XG4gICAgICAgIGlkOiBpZCxcbiAgICAgICAgcGFydHM6IFtwYXJ0XVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1N0eWxlc1tpZF0ucGFydHMucHVzaChwYXJ0KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3R5bGVzO1xufVxuXG5mdW5jdGlvbiBhZGRTdHlsZXNUb0RvbShzdHlsZXMsIG9wdGlvbnMpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaXRlbSA9IHN0eWxlc1tpXTtcbiAgICB2YXIgZG9tU3R5bGUgPSBzdHlsZXNJbkRvbVtpdGVtLmlkXTtcbiAgICB2YXIgaiA9IDA7XG5cbiAgICBpZiAoZG9tU3R5bGUpIHtcbiAgICAgIGRvbVN0eWxlLnJlZnMrKztcblxuICAgICAgZm9yICg7IGogPCBkb21TdHlsZS5wYXJ0cy5sZW5ndGg7IGorKykge1xuICAgICAgICBkb21TdHlsZS5wYXJ0c1tqXShpdGVtLnBhcnRzW2pdKTtcbiAgICAgIH1cblxuICAgICAgZm9yICg7IGogPCBpdGVtLnBhcnRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGRvbVN0eWxlLnBhcnRzLnB1c2goYWRkU3R5bGUoaXRlbS5wYXJ0c1tqXSwgb3B0aW9ucykpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcGFydHMgPSBbXTtcblxuICAgICAgZm9yICg7IGogPCBpdGVtLnBhcnRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIHBhcnRzLnB1c2goYWRkU3R5bGUoaXRlbS5wYXJ0c1tqXSwgb3B0aW9ucykpO1xuICAgICAgfVxuXG4gICAgICBzdHlsZXNJbkRvbVtpdGVtLmlkXSA9IHtcbiAgICAgICAgaWQ6IGl0ZW0uaWQsXG4gICAgICAgIHJlZnM6IDEsXG4gICAgICAgIHBhcnRzOiBwYXJ0c1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMpIHtcbiAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcblxuICBpZiAodHlwZW9mIG9wdGlvbnMuYXR0cmlidXRlcy5ub25jZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB2YXIgbm9uY2UgPSB0eXBlb2YgX193ZWJwYWNrX25vbmNlX18gIT09ICd1bmRlZmluZWQnID8gX193ZWJwYWNrX25vbmNlX18gOiBudWxsO1xuXG4gICAgaWYgKG5vbmNlKSB7XG4gICAgICBvcHRpb25zLmF0dHJpYnV0ZXMubm9uY2UgPSBub25jZTtcbiAgICB9XG4gIH1cblxuICBPYmplY3Qua2V5cyhvcHRpb25zLmF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIHN0eWxlLnNldEF0dHJpYnV0ZShrZXksIG9wdGlvbnMuYXR0cmlidXRlc1trZXldKTtcbiAgfSk7XG5cbiAgaWYgKHR5cGVvZiBvcHRpb25zLmluc2VydCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIG9wdGlvbnMuaW5zZXJ0KHN0eWxlKTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgdGFyZ2V0ID0gZ2V0VGFyZ2V0KG9wdGlvbnMuaW5zZXJ0IHx8ICdoZWFkJyk7XG5cbiAgICBpZiAoIXRhcmdldCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGRuJ3QgZmluZCBhIHN0eWxlIHRhcmdldC4gVGhpcyBwcm9iYWJseSBtZWFucyB0aGF0IHRoZSB2YWx1ZSBmb3IgdGhlICdpbnNlcnQnIHBhcmFtZXRlciBpcyBpbnZhbGlkLlwiKTtcbiAgICB9XG5cbiAgICB0YXJnZXQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICB9XG5cbiAgcmV0dXJuIHN0eWxlO1xufVxuXG5mdW5jdGlvbiByZW1vdmVTdHlsZUVsZW1lbnQoc3R5bGUpIHtcbiAgLy8gaXN0YW5idWwgaWdub3JlIGlmXG4gIGlmIChzdHlsZS5wYXJlbnROb2RlID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgc3R5bGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzdHlsZSk7XG59XG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAgKi9cblxuXG52YXIgcmVwbGFjZVRleHQgPSBmdW5jdGlvbiByZXBsYWNlVGV4dCgpIHtcbiAgdmFyIHRleHRTdG9yZSA9IFtdO1xuICByZXR1cm4gZnVuY3Rpb24gcmVwbGFjZShpbmRleCwgcmVwbGFjZW1lbnQpIHtcbiAgICB0ZXh0U3RvcmVbaW5kZXhdID0gcmVwbGFjZW1lbnQ7XG4gICAgcmV0dXJuIHRleHRTdG9yZS5maWx0ZXIoQm9vbGVhbikuam9pbignXFxuJyk7XG4gIH07XG59KCk7XG5cbmZ1bmN0aW9uIGFwcGx5VG9TaW5nbGV0b25UYWcoc3R5bGUsIGluZGV4LCByZW1vdmUsIG9iaikge1xuICB2YXIgY3NzID0gcmVtb3ZlID8gJycgOiBvYmouY3NzOyAvLyBGb3Igb2xkIElFXG5cbiAgLyogaXN0YW5idWwgaWdub3JlIGlmICAqL1xuXG4gIGlmIChzdHlsZS5zdHlsZVNoZWV0KSB7XG4gICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gcmVwbGFjZVRleHQoaW5kZXgsIGNzcyk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGNzc05vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpO1xuICAgIHZhciBjaGlsZE5vZGVzID0gc3R5bGUuY2hpbGROb2RlcztcblxuICAgIGlmIChjaGlsZE5vZGVzW2luZGV4XSkge1xuICAgICAgc3R5bGUucmVtb3ZlQ2hpbGQoY2hpbGROb2Rlc1tpbmRleF0pO1xuICAgIH1cblxuICAgIGlmIChjaGlsZE5vZGVzLmxlbmd0aCkge1xuICAgICAgc3R5bGUuaW5zZXJ0QmVmb3JlKGNzc05vZGUsIGNoaWxkTm9kZXNbaW5kZXhdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoY3NzTm9kZSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGFwcGx5VG9UYWcoc3R5bGUsIG9wdGlvbnMsIG9iaikge1xuICB2YXIgY3NzID0gb2JqLmNzcztcbiAgdmFyIG1lZGlhID0gb2JqLm1lZGlhO1xuICB2YXIgc291cmNlTWFwID0gb2JqLnNvdXJjZU1hcDtcblxuICBpZiAobWVkaWEpIHtcbiAgICBzdHlsZS5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgbWVkaWEpO1xuICB9XG5cbiAgaWYgKHNvdXJjZU1hcCAmJiBidG9hKSB7XG4gICAgY3NzICs9IFwiXFxuLyojIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxcIi5jb25jYXQoYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoc291cmNlTWFwKSkpKSwgXCIgKi9cIik7XG4gIH0gLy8gRm9yIG9sZCBJRVxuXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAgKi9cblxuXG4gIGlmIChzdHlsZS5zdHlsZVNoZWV0KSB7XG4gICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzO1xuICB9IGVsc2Uge1xuICAgIHdoaWxlIChzdHlsZS5maXJzdENoaWxkKSB7XG4gICAgICBzdHlsZS5yZW1vdmVDaGlsZChzdHlsZS5maXJzdENoaWxkKTtcbiAgICB9XG5cbiAgICBzdHlsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpKTtcbiAgfVxufVxuXG52YXIgc2luZ2xldG9uID0gbnVsbDtcbnZhciBzaW5nbGV0b25Db3VudGVyID0gMDtcblxuZnVuY3Rpb24gYWRkU3R5bGUob2JqLCBvcHRpb25zKSB7XG4gIHZhciBzdHlsZTtcbiAgdmFyIHVwZGF0ZTtcbiAgdmFyIHJlbW92ZTtcblxuICBpZiAob3B0aW9ucy5zaW5nbGV0b24pIHtcbiAgICB2YXIgc3R5bGVJbmRleCA9IHNpbmdsZXRvbkNvdW50ZXIrKztcbiAgICBzdHlsZSA9IHNpbmdsZXRvbiB8fCAoc2luZ2xldG9uID0gaW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMpKTtcbiAgICB1cGRhdGUgPSBhcHBseVRvU2luZ2xldG9uVGFnLmJpbmQobnVsbCwgc3R5bGUsIHN0eWxlSW5kZXgsIGZhbHNlKTtcbiAgICByZW1vdmUgPSBhcHBseVRvU2luZ2xldG9uVGFnLmJpbmQobnVsbCwgc3R5bGUsIHN0eWxlSW5kZXgsIHRydWUpO1xuICB9IGVsc2Uge1xuICAgIHN0eWxlID0gaW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMpO1xuICAgIHVwZGF0ZSA9IGFwcGx5VG9UYWcuYmluZChudWxsLCBzdHlsZSwgb3B0aW9ucyk7XG5cbiAgICByZW1vdmUgPSBmdW5jdGlvbiByZW1vdmUoKSB7XG4gICAgICByZW1vdmVTdHlsZUVsZW1lbnQoc3R5bGUpO1xuICAgIH07XG4gIH1cblxuICB1cGRhdGUob2JqKTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZVN0eWxlKG5ld09iaikge1xuICAgIGlmIChuZXdPYmopIHtcbiAgICAgIGlmIChuZXdPYmouY3NzID09PSBvYmouY3NzICYmIG5ld09iai5tZWRpYSA9PT0gb2JqLm1lZGlhICYmIG5ld09iai5zb3VyY2VNYXAgPT09IG9iai5zb3VyY2VNYXApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB1cGRhdGUob2JqID0gbmV3T2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlKCk7XG4gICAgfVxuICB9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChsaXN0LCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBvcHRpb25zLmF0dHJpYnV0ZXMgPSB0eXBlb2Ygb3B0aW9ucy5hdHRyaWJ1dGVzID09PSAnb2JqZWN0JyA/IG9wdGlvbnMuYXR0cmlidXRlcyA6IHt9OyAvLyBGb3JjZSBzaW5nbGUtdGFnIHNvbHV0aW9uIG9uIElFNi05LCB3aGljaCBoYXMgYSBoYXJkIGxpbWl0IG9uIHRoZSAjIG9mIDxzdHlsZT5cbiAgLy8gdGFncyBpdCB3aWxsIGFsbG93IG9uIGEgcGFnZVxuXG4gIGlmICghb3B0aW9ucy5zaW5nbGV0b24gJiYgdHlwZW9mIG9wdGlvbnMuc2luZ2xldG9uICE9PSAnYm9vbGVhbicpIHtcbiAgICBvcHRpb25zLnNpbmdsZXRvbiA9IGlzT2xkSUUoKTtcbiAgfVxuXG4gIHZhciBzdHlsZXMgPSBsaXN0VG9TdHlsZXMobGlzdCwgb3B0aW9ucyk7XG4gIGFkZFN0eWxlc1RvRG9tKHN0eWxlcywgb3B0aW9ucyk7XG4gIHJldHVybiBmdW5jdGlvbiB1cGRhdGUobmV3TGlzdCkge1xuICAgIHZhciBtYXlSZW1vdmUgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3R5bGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaXRlbSA9IHN0eWxlc1tpXTtcbiAgICAgIHZhciBkb21TdHlsZSA9IHN0eWxlc0luRG9tW2l0ZW0uaWRdO1xuXG4gICAgICBpZiAoZG9tU3R5bGUpIHtcbiAgICAgICAgZG9tU3R5bGUucmVmcy0tO1xuICAgICAgICBtYXlSZW1vdmUucHVzaChkb21TdHlsZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG5ld0xpc3QpIHtcbiAgICAgIHZhciBuZXdTdHlsZXMgPSBsaXN0VG9TdHlsZXMobmV3TGlzdCwgb3B0aW9ucyk7XG4gICAgICBhZGRTdHlsZXNUb0RvbShuZXdTdHlsZXMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBtYXlSZW1vdmUubGVuZ3RoOyBfaSsrKSB7XG4gICAgICB2YXIgX2RvbVN0eWxlID0gbWF5UmVtb3ZlW19pXTtcblxuICAgICAgaWYgKF9kb21TdHlsZS5yZWZzID09PSAwKSB7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgX2RvbVN0eWxlLnBhcnRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgX2RvbVN0eWxlLnBhcnRzW2pdKCk7XG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUgc3R5bGVzSW5Eb21bX2RvbVN0eWxlLmlkXTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG59OyIsImZ1bmN0aW9uIEN1c3RvbVNpbkN1cnZlKCBzY2FsZSApIHtcblxuICAgIFRIUkVFLkN1cnZlLmNhbGwoIHRoaXMgKTtcblxuICAgIHRoaXMuc2NhbGUgPSAoIHNjYWxlID09PSB1bmRlZmluZWQgKSA/IDEgOiBzY2FsZTtcblxufVxuXG5DdXN0b21TaW5DdXJ2ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBUSFJFRS5DdXJ2ZS5wcm90b3R5cGUgKTtcbkN1c3RvbVNpbkN1cnZlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEN1c3RvbVNpbkN1cnZlO1xuXG5DdXN0b21TaW5DdXJ2ZS5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQgKSB7XG5cbiAgICB2YXIgdHggPSB0ICogMiAtIDE7XG4gICAgdmFyIHR5ID0gTWF0aC5zaW4oIDggKiBNYXRoLlBJICogdCApO1xuICAgIHZhciB0eiA9IDA7XG5cbiAgICByZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjMoIHR4LCB0eSwgdHogKS5tdWx0aXBseVNjYWxhciggdGhpcy5zY2FsZSApO1xuXG59XG5cbmNsYXNzIFJpYnMgZXh0ZW5kcyBUSFJFRS5Hcm91cCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKClcblxuICAgIHRoaXMucGF0aCA9IG5ldyBDdXN0b21TaW5DdXJ2ZSgxMClcbiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLlR1YmVHZW9tZXRyeSh0aGlzLnBhdGgsIDIwLCAyLCA4LCBmYWxzZSlcbiAgICB0aGlzLm1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6IDB4ZTNkYWM5IH0pXG5cbiAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaCggdGhpcy5nZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCApXG5cbiAgICB0aGlzLmdlb21ldHJ5MiA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSgyNSwgMTAsIDEwKVxuICAgIHRoaXMubWF0ZXJpYWwyID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6IDB4OGIwMDAwIH0pXG5cbiAgICB0aGlzLm1lc2gyID0gbmV3IFRIUkVFLk1lc2goIHRoaXMuZ2VvbWV0cnkyLCB0aGlzLm1hdGVyaWFsMiApXG4gICAgdGhpcy5tZXNoMi5wb3NpdGlvbi5zZXQoIDAsIC0xLCAxMClcblxuXG4gICAgdGhpcy5saWdodCA9IG5ldyBUSFJFRS5TcG90TGlnaHQoIDB4ZmZmZmZmLCAxLjMsIDMwMCwgLjA3IClcbiAgICB0aGlzLmxpZ2h0LnBvc2l0aW9uLnNldCggMCwgNTAsIDIwMClcbiAgICB0aGlzLmxpZ2h0LnRhcmdldCA9IHRoaXMubWVzaDJcblxuICAgIHRoaXMucG9zaXRpb24uc2V0KDAsIDUwLCAtNDAwKVxuXG4gICAgdGhpcy5hZGQodGhpcy5tZXNoLCB0aGlzLm1lc2gyLCB0aGlzLmxpZ2h0KVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJpYnNcbiIsIlxuY2xhc3MgQmFjayBleHRlbmRzIFRIUkVFLkdyb3VwIHtcbiAgY29uc3RydWN0b3IoZ2VvbWV0cnksIG1hdGVyaWFsLCBkaXN0YW5jZSkge1xuICAgIHN1cGVyKClcblxuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcbiAgICB0aGlzLm1lc2guY2FzdFNoYWRvdyA9IHRydWU7XG4gICAgdGhpcy5tZXNoLnJlY2VpdmVTaGFkb3cgPSB0cnVlO1xuXG4gICAgbGV0IGxldHR1Y2VHZW9tZXRyeSA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDIuMSwgMi4xLCAwLjIsIDMyKTtcbiAgICBsZXQgbGV0dHVjZU1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7XG4gICAgICBjb2xvcjogMHg4NURCNDZcbiAgICB9KTtcbiAgICBsZXQgbGV0dHVjZU1lc2ggPSBuZXcgVEhSRUUuTWVzaChsZXR0dWNlR2VvbWV0cnksIGxldHR1Y2VNYXRlcmlhbCk7XG4gICAgbGV0dHVjZU1lc2gucG9zaXRpb24ueSA9IDAuMTtcblxuICAgIGxldCB0b21hdG9HZW9tZXRyeSA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDIuMSwgMi4xLCAwLjIsIDMyKTtcbiAgICBsZXQgdG9tYXRvTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtcbiAgICAgIGNvbG9yOiAweEVCNDAzOVxuICAgIH0pO1xuICAgIGxldCB0b21hdG9NZXNoID0gbmV3IFRIUkVFLk1lc2godG9tYXRvR2VvbWV0cnksIHRvbWF0b01hdGVyaWFsKTtcbiAgICB0b21hdG9NZXNoLnBvc2l0aW9uLnkgPSAtMC4xO1xuXG4gICAgbGV0IG1lYXRHZW9tZXRyeSA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDIuMSwgMi4xLCAwLjIsIDMyKTtcbiAgICBsZXQgbWVhdE1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7XG4gICAgICBjb2xvcjogMHhCQzY4M0FcbiAgICB9KTtcbiAgICBsZXQgbWVhdE1lc2ggPSBuZXcgVEhSRUUuTWVzaChtZWF0R2VvbWV0cnksIG1lYXRNYXRlcmlhbCk7XG4gICAgbWVhdE1lc2gucG9zaXRpb24ueSA9IC0wLjM7XG5cbiAgICB0aGlzLnBvc2l0aW9uLnNldCggMCwgMC41LCBkaXN0YW5jZSk7XG5cbiAgICB0aGlzLmFkZCh0aGlzLm1lc2gsIGxldHR1Y2VNZXNoLCB0b21hdG9NZXNoLCBtZWF0TWVzaCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQmFjaztcbiIsIlxuY29uc3QgUExBTkVfTEVOR1RIID0gMTAwMDtcbmNvbnN0IFBMQU5FX1dJRFRIID0gNTA7XG5jb25zdCBQQURESU5HID0gUExBTkVfV0lEVEggLyA1ICogMjtcbmNvbnN0IENPVVJTRV9PQkpFQ1RfQ09VTlQgPSA1O1xuXG5jbGFzcyBXYWxsIHtcbiAgY29uc3RydWN0b3IoZ2VvbWV0cnksIG1hdGVyaWFsLCByb3RhdGlvbiwgZGlzdGFuY2UpIHtcbiAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnNldCggMCwgMTAsIGRpc3RhbmNlICk7XG4gICAgdGhpcy5tZXNoLmNhc3RTaGFkb3cgPSB0cnVlO1xuICAgIHRoaXMubWVzaC5yZWNlaXZlU2hhZG93ID0gdHJ1ZTtcbiAgICB0aGlzLm1lc2gucm90YXRpb24ueSA9IHJvdGF0aW9uO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFdhbGw7XG4iLCJcbmltcG9ydCBCYWNrIGZyb20gJy4vYmFjay1jb21wb25lbnQuanMnO1xuaW1wb3J0IFdhbGwgZnJvbSAnLi93YWxsLWNvbXBvbmVudC5qcyc7XG5cbmNsYXNzIFBhdGgge1xuICBjb25zdHJ1Y3RvcihoZXJvQ29udGFpbmVyLCBoZXJvLCBwb3NpdGlvbiwgdHVybiwgb3B0cykge1xuICAgIHRoaXMuaGVyb0NvbnRhaW5lciA9IGhlcm9Db250YWluZXI7XG4gICAgdGhpcy5oZXJvID0gaGVybztcbiAgICB0aGlzLnBhdGhMZW5ndGggPSBvcHRzLnBhdGhMZW5ndGg7XG4gICAgdGhpcy5ncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpO1xuICAgIHRoaXMuZ3JvdXAucG9zaXRpb24ueCA9IHBvc2l0aW9uID8gcG9zaXRpb24ueCA6IDA7XG4gICAgdGhpcy5ncm91cC5wb3NpdGlvbi55ID0gcG9zaXRpb24gPyBwb3NpdGlvbi55IDogMDtcbiAgICB0aGlzLmdyb3VwLnBvc2l0aW9uLnogPSAtdGhpcy5wYXRoTGVuZ3RoLzI7XG5cbiAgICB0aGlzLnR1cm4gPSB0dXJuO1xuICAgIHRoaXMudGFjb0Rpc3RhbmNlID0gb3B0cy50YWNvRGlzdGFuY2U7XG4gICAgdGhpcy5idXJnZXJEaXN0YW5jZXMgPSBvcHRzLmJ1cmdlckRpc3RhbmNlcztcbiAgICB0aGlzLnBsYW5lRGlzdGFuY2VzID0gb3B0cy5wbGFuZURpc3RhbmNlcztcbiAgICB0aGlzLnBhdXNlZCA9IHRydWU7XG4gICAgdGhpcy5wYXRoU2VnbWVudHNMZW5ndGggPSAxO1xuICB9XG5cbiAgX2NyZWF0ZVdhbGwoZGlzdGFuY2UpIHtcbiAgICBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSgyMCwgMjAsIDIsIDIpO1xuICAgIFxuICAgIGxldCBvYmplY3RNYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7XG4gICAgICBjb2xvcjogMHhmZmE1MDAsXG4gICAgICBmbGF0U2hhZGluZzogVEhSRUUuRmxhdFNoYWRpbmdcbiAgICB9KTtcblxuICAgIHRoaXMucGx1c09yTWludXMgPSBNYXRoLnJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xuICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5wbHVzT3JNaW51cyA+IDAgPyAnbGVmdCcgOiAncmlnaHQnO1xuXG4gICAgbGV0IHJvdGF0aW9uID0gMiAqIHRoaXMucGx1c09yTWludXM7XG5cbiAgICBsZXQgY291cnNlT2JqZWN0ID0gbmV3IFdhbGwoZ2VvbWV0cnksIG9iamVjdE1hdGVyaWFsLCByb3RhdGlvbiwgZGlzdGFuY2UpO1xuXG4gICAgdGhpcy5ncm91cC5hZGQoIGNvdXJzZU9iamVjdC5tZXNoICk7XG4gIH1cblxuICBfY3JlYXRlQmFjayhkaXN0YW5jZSkge1xuICAgIGNvbnN0IHZlcnRpY2VzT2ZDdWJlID0gW1xuICAgICAgLTEsIC0xLCAtMSwgICAgMSwgLTEsIC0xLCAgICAxLCAgMSwgLTEsICAgIC0xLCAgMSwgLTEsXG4gICAgICAtMSwgLTEsICAxLCAgICAxLCAtMSwgIDEsICAgIDEsICAxLCAgMSwgICAgLTEsICAxLCAgMSxcbiAgICBdO1xuICAgIGNvbnN0IGluZGljZXNPZkZhY2VzID0gW1xuICAgICAgMiwgMSwgMCwgICAgMCwgMywgMixcbiAgICAgIDAsIDQsIDcsICAgIDcsIDMsIDAsXG4gICAgICAwLCAxLCA1LCAgICA1LCA0LCAwLFxuICAgICAgMSwgMiwgNiwgICAgNiwgNSwgMSxcbiAgICAgIDIsIDMsIDcsICAgIDcsIDYsIDIsXG4gICAgICA0LCA1LCA2LCAgICA2LCA3LCA0LFxuICAgIF07XG4gICAgY29uc3QgcmFkaXVzID0gMjtcbiAgICBjb25zdCBkZXRhaWwgPSAyO1xuICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBvbHloZWRyb25CdWZmZXJHZW9tZXRyeSh2ZXJ0aWNlc09mQ3ViZSwgaW5kaWNlc09mRmFjZXMsIHJhZGl1cywgZGV0YWlsKTtcbiAgICBcbiAgICBsZXQgb2JqZWN0TWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCgge1xuICAgICAgY29sb3I6IDB4RUY5ODJFLFxuICAgICAgZmxhdFNoYWRpbmc6IFRIUkVFLkZsYXRTaGFkaW5nXG4gICAgfSk7XG5cbiAgICBsZXQgY291cnNlT2JqZWN0ID0gbmV3IEJhY2soZ2VvbWV0cnksIG9iamVjdE1hdGVyaWFsLCBkaXN0YW5jZSAqIDUwKTtcbiAgICB0aGlzLmdyb3VwLmFkZCggY291cnNlT2JqZWN0ICk7XG4gIH1cblxuICBfY3JlYXRlUGxhbmUoZGlzdGFuY2UpIHtcbiAgICBsZXQgcGxhbmVHZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMTAsIDUwLCAxICk7XG4gICAgbGV0IHBsYW5lTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCgge1xuICAgICAgY29sb3I6IDB4NDQwYzY1XG4gICAgfSApO1xuXG4gICAgbGV0IHBsYW5lID0gbmV3IFRIUkVFLk1lc2goIHBsYW5lR2VvbWV0cnksIHBsYW5lTWF0ZXJpYWwgKTtcblxuICAgIHBsYW5lLnBvc2l0aW9uLnogPSBkaXN0YW5jZSAqIDUwO1xuICAgIHBsYW5lLnJvdGF0aW9uLnggPSAtMS41NzA7XG4gICAgcGxhbmUucmVjZWl2ZVNoYWRvdyA9IHRydWU7XG5cbiAgICB0aGlzLmdyb3VwLmFkZCggcGxhbmUgKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgaWYgKHRoaXMucGxhbmVEaXN0YW5jZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICB0aGlzLmdyb3VwLnJlbW92ZSh0aGlzLnBsYW5lKTtcblxuICAgICAgdGhpcy5wbGFuZURpc3RhbmNlcy5mb3JFYWNoKGRpc3RhbmNlID0+IHtcbiAgICAgICAgdGhpcy5fY3JlYXRlUGxhbmUoZGlzdGFuY2UpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucGF0aFNlZ21lbnRzTGVuZ3RoID0gdGhpcy5wbGFuZURpc3RhbmNlcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgdGhpcy5fY3JlYXRlV2FsbCh0aGlzLnRhY29EaXN0YW5jZSk7XG5cbiAgICB0aGlzLmJ1cmdlckRpc3RhbmNlcy5mb3JFYWNoKGRpc3RhbmNlID0+IHtcbiAgICAgIHRoaXMuX2NyZWF0ZUJhY2soZGlzdGFuY2UpO1xuICAgIH0pO1xuICB9XG5cbiAgaW5pdFBsYW5lKCkge1xuICAgIC8qIFRSQUNLICovXG4gICAgbGV0IHBsYW5lR2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEwLCAxMDAwLCAxICk7XG4gICAgbGV0IHBsYW5lTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCgge1xuICAgICAgY29sb3I6IDB4NDQwYzY1XG4gICAgfSApO1xuXG4gICAgdGhpcy5wbGFuZSA9IG5ldyBUSFJFRS5NZXNoKCBwbGFuZUdlb21ldHJ5LCBwbGFuZU1hdGVyaWFsICk7XG5cbiAgICB0aGlzLnBsYW5lLnJvdGF0aW9uLnggPSAtMS41NzA7XG4gICAgdGhpcy5wbGFuZS5yZWNlaXZlU2hhZG93ID0gdHJ1ZTtcblxuICAgIHRoaXMuZ3JvdXAuYWRkKHRoaXMucGxhbmUpO1xuICB9XG5cbiAgZGV0ZWN0V2FsbCgpIHtcbiAgICBsZXQgd2FsbHMgPSB0aGlzLndhbGxzLm1hcChvYmogPT4gb2JqLm1lc2gpO1xuICAgIGxldCByYXlXYWxsID0gbmV3IFRIUkVFLlJheWNhc3RlciggdGhpcy5oZXJvLm1lc2gucG9zaXRpb24sIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKSk7XG4gICAgbGV0IHdhbGxJbnRlcnNlY3Rpb25zID0gcmF5V2FsbC5pbnRlcnNlY3RPYmplY3RzKCB3YWxscyApO1xuXG4gICAgaWYgKFxuICAgICAgd2FsbEludGVyc2VjdGlvbnMubGVuZ3RoID4gMCAmJlxuICAgICAgd2FsbEludGVyc2VjdGlvbnNbMF0uZGlzdGFuY2UgPCAyXG4gICAgKSB7XG4gICAgICBpZiAodGhpcy5oZXJvLnNwaW5uaW5nKSB7XG4gICAgICAgIHRoaXMudHVybigpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhZGRTY29yZShwdHMpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2NvcmUnKS5pbm5lckhUTUwgPSB0aGlzLmhlcm8uc2NvcmUgKz0gcHRzO1xuICB9XG5cbiAgZGV0ZWN0Q29sbGlzaW9ucygpIHtcbiAgICBsZXQgcmF5SnVtcCA9IG5ldyBUSFJFRS5SYXljYXN0ZXIoIHRoaXMuaGVyby5tZXNoLnBvc2l0aW9uLCBuZXcgVEhSRUUuVmVjdG9yMygwLCAtMSwgMCkgKTtcbiAgICBsZXQgcmF5Q29sbGlzaW9uID0gbmV3IFRIUkVFLlJheWNhc3RlciggdGhpcy5oZXJvLm1lc2gucG9zaXRpb24sIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKSk7XG5cbiAgICBsZXQgY291cnNlT2JqZWN0cyA9IHRoaXMuZ3JvdXAuY2hpbGRyZW4uc2xpY2UodGhpcy5wYXRoU2VnbWVudHNMZW5ndGgpLm1hcChvYmogPT4ge1xuICAgICAgaWYgKHR5cGVvZiBvYmoubWVzaCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIG9ialxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG9iai5tZXNoXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsZXQgaW50ZXJzZWN0aW9ucyA9IHJheUp1bXAuaW50ZXJzZWN0T2JqZWN0cyggY291cnNlT2JqZWN0cyApO1xuICAgIGxldCBjb2xsaXNpb25JbnRlcnNlY3Rpb25zID0gcmF5Q29sbGlzaW9uLmludGVyc2VjdE9iamVjdHMoIGNvdXJzZU9iamVjdHMgKTtcblxuICAgIGxldCBwYXRoID0gdGhpcy5ncm91cC5jaGlsZHJlbi5zbGljZSgwLCB0aGlzLnBhdGhTZWdtZW50c0xlbmd0aCk7XG4gICAgbGV0IHBhdGhJbnRlcnNlY3Rpb25zID0gcmF5SnVtcC5pbnRlcnNlY3RPYmplY3RzKCBwYXRoICk7XG5cbiAgICBpZiAoIHBhdGhJbnRlcnNlY3Rpb25zLmxlbmd0aCA+IDAgJiYgcGF0aEludGVyc2VjdGlvbnNbMF0uZGlzdGFuY2UgPCAyICkge1xuICAgICAgdGhpcy5oZXJvLnNwaW5BdmFpbGFibGUgPSB0cnVlO1xuICAgICAgdGhpcy5oZXJvQ29udGFpbmVyLnBvc2l0aW9uLnkgPSBwYXRoSW50ZXJzZWN0aW9uc1swXS5wb2ludC55ICsgMC4xO1xuICAgIH0gZWxzZSBpZiAodGhpcy5oZXJvLm1lc2gucG9zaXRpb24ueSA8PSAxLjgpIHtcbiAgICAgIHRoaXMuaGVyb0NvbnRhaW5lci5wb3NpdGlvbi55IC09IDAuNTtcbiAgICB9XG5cblxuICAgIGlmICggaW50ZXJzZWN0aW9ucy5sZW5ndGggPiAwICYmIGludGVyc2VjdGlvbnNbMF0uZGlzdGFuY2UgPCAyKSB7XG4gICAgICB0aGlzLmhlcm8uanVtcCgpO1xuICAgICAgdGhpcy5oZXJvLnNwaW5BdmFpbGFibGUgPSB0cnVlO1xuICAgICAgdGhpcy5hZGRTY29yZSg1KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIGNvbGxpc2lvbkludGVyc2VjdGlvbnMubGVuZ3RoID4gMCAmJiBjb2xsaXNpb25JbnRlcnNlY3Rpb25zWzBdLmRpc3RhbmNlIDwgMy41KSB7XG4gICAgICBsZXQgaXNXYWxsID0gY29sbGlzaW9uSW50ZXJzZWN0aW9uc1swXS5vYmplY3QuZ2VvbWV0cnkudHlwZSA9PT0gXCJCb3hHZW9tZXRyeVwiO1xuXG4gICAgICBpZiAoaXNXYWxsKSB7XG4gICAgICAgIGlmICh0aGlzLmhlcm8uc3Bpbm5pbmcgJiYgdGhpcy5kaXJlY3Rpb24gPT09IHRoaXMuaGVyby5zcGluRGlyZWN0aW9uKSB7XG4gICAgICAgICAgdGhpcy50dXJuKCk7XG5cbiAgICAgICAgICB0aGlzLmFkZFNjb3JlKDEwKTtcbiAgICAgICAgICB0aGlzLmhlcm8uc3BpbkF2YWlsYWJsZSA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwYXVzZUdhbWUoKSB7XG4gICAgdGhpcy5wYXVzZWQgPSB0cnVlO1xuICB9XG5cbiAgcGxheUdhbWUoKSB7XG4gICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQYXRoO1xuIiwiXG5jbGFzcyBCYWNrZ3JvdW5kIGV4dGVuZHMgVEhSRUUuR3JvdXAge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoKVxuICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUJ1ZmZlckdlb21ldHJ5KDUwMCwgMzIsIDMyKVxuICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKFxuICAgICAge1xuICAgICAgICB1bmlmb3Jtczoge1xuICAgICAgICAgIHQ6IHsgdHlwZTogJ2MnLCB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKDB4MjkzNDYyKSB9LFxuICAgICAgICAgIGI6IHsgdHlwZTogJ2MnLCB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKDB4M2ExZjVkKSB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcnRleFNoYWRlcjogYFxuICAgICAgICAgIHZhcnlpbmcgdmVjMyB2O1xuXG4gICAgICAgICAgdm9pZCBtYWluKCkge1xuXG4gICAgICAgICAgICB2ZWM0IHcgPSBtb2RlbE1hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbiAgICAgICAgICAgIHYgPSB3Lnh5ejtcbiAgICBcbiAgICAgICAgICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcblxuICAgICAgICAgIH1cbiAgICAgICAgYCxcbiAgICAgICAgZnJhZ21lbnRTaGFkZXI6IGBcbiAgICAgICAgICB1bmlmb3JtIHZlYzMgdDtcbiAgICAgICAgICB1bmlmb3JtIHZlYzMgYjtcbiAgICAgICAgICB2YXJ5aW5nIHZlYzMgdjtcblxuICAgICAgICAgIHZvaWQgbWFpbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHZlYzMgcCA9IG5vcm1hbGl6ZSh2Lnh5eik7XG4gICAgICAgICAgICAgIGZsb2F0IGYgPSBzaW4ocC55ICogMi4wKTtcblxuICAgICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KG1peCh0LGIsIGYgKSwgMS4wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgYCxcbiAgICAgICAgc2lkZTogVEhSRUUuQmFja1NpZGVcbiAgICAgIH1cbiAgICApXG5cblxuICAgIHRoaXMuc2t5ID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsKVxuICAgIHRoaXMuYWRkKHRoaXMuc2t5KVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEJhY2tncm91bmQ7IiwiaW1wb3J0ICcuL3N0eWxlcy9zdHlsZS5zYXNzJztcblxuaW1wb3J0IEhlcm8gZnJvbSAnLi9jb21wb25lbnRzL2hlcm8tY29tcG9uZW50LmpzJztcbmltcG9ydCBQYXRoIGZyb20gJy4vY29tcG9uZW50cy9wYXRoLWNvbXBvbmVudC5qcyc7XG5pbXBvcnQgUmlicyBmcm9tICcuL2NvbXBvbmVudHMvcmlicy1jb21wb25lbnQuanMnO1xuaW1wb3J0IEJhY2tncm91bmQgZnJvbSAnLi9jb21wb25lbnRzL2JhY2tncm91bmQtY29tcG9uZW50LmpzJztcblxuXG5jb25zdCBQTEFORV9MRU5HVEggPSAxMDAwO1xuY29uc3QgUExBTkVfV0lEVEggPSA1MDtcbmNvbnN0IFBBRERJTkcgPSBQTEFORV9XSURUSCAvIDUgKiAyO1xuY29uc3QgQ09VUlNFX09CSkVDVF9DT1VOVCA9IDU7XG5cbmxldCBoZXJvQmFzZVk9MS44O1xubGV0IHJlbmRlcmVyLFxuICBoZXJvLFxuICBoZXJvQ29udGFpbmVyLFxuICBnb2FsLFxuICBzY2VuZSxcbiAgY2FtZXJhLFxuICB1c2VyLFxuICBjYW52YXNXaWR0aCxcbiAgY2FudmFzSGVpZ2h0LFxuICBoaVNjb3JlLFxuICByaWJzLFxuICBwYXRoLFxuICBwYXRocyA9IFtdO1xuXG5sZXQgdHVybiA9ICgpID0+IHtcbiAgcGF1c2VHYW1lKCk7XG5cbiAgbGV0IHBvc1ggPSBwYXRoc1swXS5kaXJlY3Rpb24gPT09ICdsZWZ0JyA/IC0yMCA6IDIwO1xuXG4gIGxldCBwb3NpdGlvbiA9IHtcbiAgICB4OiBwYXRoc1swXS5ncm91cC5wb3NpdGlvbi54ICsgcG9zWCxcbiAgICB5OiBwYXRoc1swXS5ncm91cC5wb3NpdGlvbi55XG4gIH1cblxuICBsZXQgb3B0cyA9IHtcbiAgICBwYXRoTGVuZ3RoOiAxMDAwLFxuICAgIHRhY29EaXN0YW5jZTogLTUwMCxcbiAgICBidXJnZXJEaXN0YW5jZXM6IFstNiwgMywgNCwgNSwgNiwgN10sXG4gICAgcGxhbmVEaXN0YW5jZXM6IFtdXG4gIH1cblxuICBwYXRoID0gbmV3IFBhdGgoaGVyb0NvbnRhaW5lciwgaGVybywgcG9zaXRpb24sIHR1cm4sIG9wdHMpO1xuICBwYXRoLmluaXRQbGFuZSgpO1xuICBwYXRoLmluaXQoKTtcbiAgcGF0aHMucHVzaChwYXRoKTtcblxuICAvKiBTQ0VORSAqL1xuICBzY2VuZS5hZGQoIHBhdGhzWzFdLmdyb3VwICk7XG5cbiAgbGV0IHBvc0RlbHRhID0ge1xuICAgIHg6IHBvc2l0aW9uLnggLSBwYXRoc1swXS5ncm91cC5wb3NpdGlvbi54LFxuICAgIHk6IHBvc2l0aW9uLnkgLSBwYXRoc1swXS5ncm91cC5wb3NpdGlvbi55XG4gIH07XG5cbiAgaGVyby5jaGFuZ2VEaXJlY3Rpb24ocGF0aHNbMF0uZGlyZWN0aW9uLCBwb3NEZWx0YSk7XG5cbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgc2NlbmUucmVtb3ZlKHBhdGhzWzBdLmdyb3VwKTtcbiAgICBwYXRocy5zaGlmdCgpO1xuXG4gICAgcGF0aHNbMF0ucGxheUdhbWUoKTtcbiAgfSwgMzAwKTtcbn07XG5cbmxldCBzZXRTY29yZSA9ICgpID0+IHtcbiAgaGlTY29yZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaXdtYmJyJyk7XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY29yZScpLmlubmVySFRNTCA9IDA7XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNoaS1zY29yZScpLmlubmVySFRNTCA9IGhpU2NvcmUgPyBoaVNjb3JlIDogMDtcbiAgaGVyby5zY29yZSA9IDA7XG59OyAgXG5cbmxldCBpbml0SGVybyA9ICgpID0+IHtcblxuICBsZXQgaGVyb0dlb21ldHJ5ID0gbmV3IFRIUkVFLk9jdGFoZWRyb25HZW9tZXRyeSggMS41ICk7XG4gIGhlcm9HZW9tZXRyeS5zY2FsZSgwLjcsIDEsIDAuNyk7XG4gIGxldCBoZXJvTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCgge1xuICBjb2xvcjogMHhFOTFFNjMsXG4gIGZsYXRTaGFkaW5nOiBUSFJFRS5GbGF0U2hhZGluZ1xuICB9ICk7XG5cbiAgaGVybyA9IG5ldyBIZXJvKCBoZXJvR2VvbWV0cnksIGhlcm9NYXRlcmlhbCApO1xuXG4gIGdvYWwgPSBuZXcgVEhSRUUuT2JqZWN0M0Q7XG5cbiAgZ29hbC5wb3NpdGlvbi5zZXQoMCwgMiwgLTIpO1xuICBoZXJvLm1lc2guYWRkKCBnb2FsICk7XG4gIGhlcm9Db250YWluZXIgPSBuZXcgVEhSRUUuT2JqZWN0M0Q7XG4gIGhlcm9Db250YWluZXIuYWRkKGhlcm8ubWVzaCk7XG5cbiAgc2NlbmUuYWRkKCBoZXJvQ29udGFpbmVyICk7XG4gIFxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCAoKSA9PiB7XG5cbiAgICBpZiAoIGV2ZW50LmtleUNvZGUgPT09IDM3ICkge1xuICAgICAgaGVyby5zcGluKCdsZWZ0Jyk7XG4gICAgfSBlbHNlIGlmICggZXZlbnQua2V5Q29kZSA9PT0gMzkgKSB7XG4gICAgICBoZXJvLnNwaW4oJ3JpZ2h0Jyk7XG4gICAgfVxuXG4gICAgaWYgKGhlcm8ubWVzaC5wb3NpdGlvbi55ID4gaGVyby5oZXJvQmFzZVkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIGV2ZW50LmtleUNvZGUgPT09IDM4ICkge1xuICAgICAgaGVyby5qdW1wKCk7XG4gICAgfVxuICB9ICk7XG59XG5cbmxldCBpbml0QmFja2dyb3VuZCA9ICgpID0+IHtcblxuICBsZXQgYmFja2dyb3VuZCA9IG5ldyBCYWNrZ3JvdW5kKCk7XG4gIHJpYnMgPSBuZXcgUmlicygpO1xuXG4gIHNjZW5lLmFkZChiYWNrZ3JvdW5kLCByaWJzKTtcbn1cblxubGV0IGluaXRHYW1lID0gKCkgPT4ge1xuICBsZXQgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbWUnKTtcblxuICBUSFJFRS5JbWFnZVV0aWxzLmNyb3NzT3JpZ2luID0gJyc7XG5cbiAgY2FudmFzV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgY2FudmFzSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gIHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoe2NhbnZhc30pO1xuICByZW5kZXJlci5zZXRTaXplKCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0ICk7XG4gIHJlbmRlcmVyLmFudGlhbGlhcyA9IHRydWU7XG4gIHJlbmRlcmVyLnNldENsZWFyQ29sb3IoIDB4RkZGRkZGLCAxICk7XG4gIHJlbmRlcmVyLnNoYWRvd01hcC5lbmFibGVkID0gdHJ1ZTtcbiAgcmVuZGVyZXIuc2hhZG93TWFwU29mdCA9IHRydWU7XG5cbiAgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcblxuICAvKiBDQU1FUkEgKi9cbiAgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA0NSwgY2FudmFzV2lkdGggLyBjYW52YXNIZWlnaHQsIDEsIDMwMDAgKTtcbiAgY2FtZXJhLnBvc2l0aW9uLnNldCggMCwgMTAsIDAgKTtcblxuICAvKiBMSUdIVFMgKi9cbiAgbGV0IGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDEgKTtcbiAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIC0xLCAxLCAwICk7XG4gIGxldCBoZW1pc3BoZXJlTGlnaHQgPSBuZXcgVEhSRUUuSGVtaXNwaGVyZUxpZ2h0KCAweEZGQjc0RCwgMHgzNzQ3NEYsIDEgKTtcbiAgaGVtaXNwaGVyZUxpZ2h0LnBvc2l0aW9uLnkgPSA1MDA7XG5cbiAgLy8gbGV0IHNwb3RMaWdodCA9IG5ldyBUSFJFRS5TcG90TGlnaHQoIDB4ZmZmZmZmIClcbiAgLy8gc3BvdExpZ2h0LnBvc2l0aW9uLnNldCggMCwgNTAsIC00MDApXG5cbiAgLyogSEVSTyAqL1xuICBpbml0SGVybygpO1xuXG4gIHNldFNjb3JlKCk7XG5cbiAgaW5pdEJhY2tncm91bmQoKTtcblxuICBjYW1lcmEubG9va0F0KCBoZXJvLm1lc2gucG9zaXRpb24gKTtcbiAgbGV0IHBvc2l0aW9uID0ge1xuICAgIHg6IDAsXG4gICAgeTogMCxcbiAgICB6OiAwXG4gIH1cblxuICBsZXQgb3B0cyA9IHtcbiAgICBwYXRoTGVuZ3RoOiAxMDAwLFxuICAgIHRhY29EaXN0YW5jZTogLTUwMCxcbiAgICBidXJnZXJEaXN0YW5jZXM6IFsgLTMsIC00LCAtNSwgLTYsIC03LCAtOCwgLTksIC0xMF0sXG4gICAgcGxhbmVEaXN0YW5jZXM6IFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF1cbiAgfVxuXG4gIHBhdGggPSBuZXcgUGF0aChoZXJvQ29udGFpbmVyLCBoZXJvLCBwb3NpdGlvbiwgdHVybiwgb3B0cyk7XG5cbiAgcGF0aC5pbml0UGxhbmUoKTtcbiAgcGF0aHMucHVzaChwYXRoKTtcblxuICB1c2VyID0gbmV3IFRIUkVFLkdyb3VwKCk7XG4gIHVzZXIuYWRkKGNhbWVyYSk7XG5cbiAgLyogU0NFTkUgKi9cbiAgc2NlbmUuYWRkKCB1c2VyLCBkaXJlY3Rpb25hbExpZ2h0LCBoZW1pc3BoZXJlTGlnaHQsIHBhdGhzWzBdLmdyb3VwICk7XG5cbiAgcmVuZGVyKCk7XG5cbiAgbGV0ICRzdGFydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdGFydCcpO1xuICBsZXQgJHJlc3RhcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVzdGFydCcpO1xuXG4gICRzdGFydC5vbmNsaWNrID0gKCkgPT4ge1xuICAgIHJ1bkdhbWUoKTtcbiAgICAkc3RhcnQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gIH07XG5cbiAgJHJlc3RhcnQub25jbGljayA9ICgpID0+IHtcblxuICAgIHNjZW5lLnJlbW92ZShwYXRoc1swXS5ncm91cCk7XG4gICAgcGF0aHMuc2hpZnQoKTtcblxuICAgIGxldCBwb3NpdGlvbiA9IHtcbiAgICAgIHg6IGhlcm8ubWVzaC5wb3NpdGlvbi54LFxuICAgICAgeTogMCxcbiAgICAgIHo6IDBcbiAgICB9XG5cbiAgICBwYXRoID0gbmV3IFBhdGgoaGVyb0NvbnRhaW5lciwgaGVybywgcG9zaXRpb24sIHR1cm4sIG9wdHMpO1xuXG4gICAgcGF0aC5pbml0UGxhbmUoKTtcbiAgICBwYXRocy5wdXNoKHBhdGgpO1xuXG4gICAgLyogU0NFTkUgKi9cbiAgICBzY2VuZS5hZGQoIHBhdGguZ3JvdXAgKTtcblxuICAgIHJ1bkdhbWUoKTtcbiAgICAkcmVzdGFydC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgfTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplICk7XG4gIG9uV2luZG93UmVzaXplKCk7XG5cbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggVEhSRUUuV0VCVlIuY3JlYXRlQnV0dG9uKCByZW5kZXJlciApICk7XG4gIHJlbmRlcmVyLnZyLmVuYWJsZWQgPSB0cnVlO1xufVxuXG5sZXQgZ2FtZU92ZXIgPSAoKSA9PiB7XG4gIGxldCAkcmVzdGFydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZXN0YXJ0Jyk7XG4gIGhpU2NvcmUgPSBoZXJvLnNjb3JlID4gaGlTY29yZSA/IGhlcm8uc2NvcmUgOiBoaVNjb3JlO1xuICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2l3bWJicicsIGhpU2NvcmUpO1xuICBwYXRoc1swXS5wYXVzZUdhbWUoKTtcblxuICAkcmVzdGFydC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbn1cblxubGV0IHVwZGF0ZSA9ICgpID0+IHtcblxuICBsZXQgaXNDb2xsaWRlZDtcbiAgXG4gIGhlcm8udXBkYXRlKCk7XG5cbiAgcGF0aHMuZm9yRWFjaChwYXRoID0+IHtcbiAgICBpZiAoIXBhdGgucGF1c2VkKSB7XG4gICAgICBpZiAoIHBhdGguZ3JvdXAucG9zaXRpb24ueiA8IFBMQU5FX0xFTkdUSCApIHtcbiAgICAgICAgcGF0aC5ncm91cC5wb3NpdGlvbi56ICs9IDI7XG5cbiAgICAgICAgaXNDb2xsaWRlZCA9IHBhdGguZGV0ZWN0Q29sbGlzaW9ucygpO1xuICAgICAgfVxuICAgIH1cblxuICB9KTtcblxuICBpZiAoIGlzQ29sbGlkZWQgKSB7XG4gICAgZ2FtZU92ZXIoKTtcbiAgfVxuXG5cbiAgaWYgKGhlcm8udHVybikge1xuICAgIGNhbWVyYS5wb3NpdGlvbi55ID0gaGVyby5tZXNoLnBvc2l0aW9uLnkgKyAzO1xuICAgIGNhbWVyYS5wb3NpdGlvbi56ID0gaGVyby5tZXNoLnBvc2l0aW9uLnogKyA0MDtcbiAgfSBlbHNlIHtcbiAgICBjYW1lcmEucG9zaXRpb24ueSA9IDEwO1xuICB9XG5cbiAgICBjYW1lcmEucG9zaXRpb24ueCA9IGhlcm8ubWVzaC5wb3NpdGlvbi54O1xufVxuXG5sZXQgcmVuZGVyID0gKCkgPT4ge1xuICByZW5kZXJlci5zZXRBbmltYXRpb25Mb29wKCgpID0+IHtcbiAgICByZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmEgKTtcbiAgICB1cGRhdGUoKTtcbiAgfSk7XG59XG5cbmxldCBvbldpbmRvd1Jlc2l6ZSA9ICgpID0+IHtcblxuICBjYW52YXNIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gIGNhbnZhc1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gIHJlbmRlcmVyLnNldFNpemUoY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCk7XG4gIGNhbWVyYS5hc3BlY3QgPSBjYW52YXNXaWR0aC9jYW52YXNIZWlnaHQ7XG4gIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG59XG5cbmxldCBwYXVzZUdhbWUgPSAoKSA9PiB7XG4gIHBhdGhzWzBdLnBhdXNlR2FtZSgpO1xufVxuXG5sZXQgcnVuR2FtZSA9ICgpID0+IHtcbiAgaGVyby5zcGlubmluZyA9IGZhbHNlO1xuICBoZXJvLmp1bXBpbmcgPSBmYWxzZTtcbiAgaGVyby5zcGluVmFsdWUgPSAwO1xuICBwYXRoc1swXS5pbml0KCk7XG4gIHBhdGhzWzBdLnBsYXlHYW1lKCk7XG4gIHNldFNjb3JlKCk7XG5cbiAgdXBkYXRlKCk7XG4gIGhlcm8ubWVzaC5yb3RhdGlvbi56ID0gMDtcbn1cblxuaW5pdEdhbWUoKTsiLCJcbmNvbnN0IFBMQU5FX0xFTkdUSCA9IDEwMDA7XG5jb25zdCBMRUZUX1NQSU5fVkFMVUUgPSAtMC40O1xuY29uc3QgUklHSFRfU1BJTl9WQUxVRSA9IDAuNDtcblxuY2xhc3MgSGVybyB7XG4gIGNvbnN0cnVjdG9yKGdlb21ldHJ5LCBtYXRlcmlhbCkge1xuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcbiAgICB0aGlzLm1lc2guY2FzdFNoYWRvdyA9IHRydWU7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnNldCggMCwgNSwgLTI1ICk7XG4gICAgdGhpcy5tZXNoLnJvdGF0aW9uLnggPSAwLjQ4NTtcbiAgICB0aGlzLmdyYXZpdHk9MC4wMTtcbiAgICB0aGlzLmJvdW5jZVZhbHVlID0gMDtcbiAgICB0aGlzLnNwaW5WYWx1ZSA9IDA7XG4gICAgdGhpcy5zcGluRGlyZWN0aW9uID0gJ2xlZnQnO1xuICAgIHRoaXMuc3Bpbm5pbmcgPSBmYWxzZTtcbiAgICB0aGlzLnNwaW5BdmFpbGFibGUgPSB0cnVlO1xuICAgIHRoaXMudHVybiA9IGZhbHNlO1xuICAgIHRoaXMuaGVyb0Jhc2VZPTEuODtcbiAgICB0aGlzLmhlcm9CYXNlWD0wO1xuICAgIHRoaXMuc2NvcmUgPSAwO1xuICB9XG5cbiAgc3BpbihkaXJlY3Rpb24pIHtcbiAgICBpZiAoIXRoaXMuc3BpbkF2YWlsYWJsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc3BpbkF2YWlsYWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuc3BpbkRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICB0aGlzLnNwaW5uaW5nID0gdHJ1ZTtcbiAgICB0aGlzLm1lc2gucm90YXRpb24ueSArPSAwLjQ7XG5cbiAgICB0aGlzLmp1bXBpbmcgPSB0cnVlO1xuICAgIHRoaXMuYm91bmNlVmFsdWUgPSAwLjE1O1xuICB9XG5cbiAganVtcCgpIHtcbiAgICB0aGlzLmp1bXBpbmcgPSB0cnVlO1xuICAgIHRoaXMuYm91bmNlVmFsdWUgPSAwLjI7XG4gIH1cblxuICBjaGFuZ2VEaXJlY3Rpb24oZGlyZWN0aW9uLCBwb3NEZWx0YSkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICB0aGlzLnR1cm4gPSB0cnVlO1xuICAgIHRoaXMudHVybkRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICB0aGlzLnBvc0RlbHRhID0gcG9zRGVsdGE7XG4gICAgdGhpcy5oZXJvQmFzZVggKz0gcG9zRGVsdGEueDtcbiAgfVxuXG4gIHVwZGF0ZSgpIHtcbiAgICBpZiAodGhpcy5zcGlubmluZykge1xuICAgICAgaWYgKE1hdGguYWJzKHRoaXMubWVzaC5yb3RhdGlvbi55KSA+IDEwKSB7XG4gICAgICAgIHRoaXMubWVzaC5yb3RhdGlvbi55ID0gMDtcbiAgICAgICAgdGhpcy5zcGluVmFsdWUgPSAwO1xuICAgICAgICB0aGlzLnNwaW5uaW5nID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5zcGluRGlyZWN0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgICAgICB0aGlzLnNwaW5WYWx1ZSA9IExFRlRfU1BJTl9WQUxVRTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNwaW5WYWx1ZSA9IFJJR0hUX1NQSU5fVkFMVUU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy50dXJuKSB7XG4gICAgICBpZiAodGhpcy5tZXNoLnBvc2l0aW9uLnggPT09IHRoaXMuaGVyb0Jhc2VYKSB7XG4gICAgICAgIHRoaXMudHVybiA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oZXJvQmFzZVkgKz0gdGhpcy5wb3NEZWx0YS55LzEwO1xuICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueCArPSB0aGlzLnBvc0RlbHRhLngvMTA7XG4gICAgICAgIC8vIHRoaXMubWVzaC5wb3NpdGlvbi55ICs9IHRoaXMucG9zRGVsdGEueS8xMDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm1lc2gucG9zaXRpb24ueTw9dGhpcy5oZXJvQmFzZVkpIHtcblxuICAgICAgaWYgKHRoaXMuanVtcGluZykge1xuICAgICAgICB0aGlzLmp1bXBpbmcgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuYm91bmNlVmFsdWUgPSAwO1xuICAgICAgICB0aGlzLnNwaW5uaW5nID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYm91bmNlVmFsdWUtPXRoaXMuZ3Jhdml0eTtcbiAgICB9XG5cbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IE1hdGgubWF4KHRoaXMubWVzaC5wb3NpdGlvbi55ICsgdGhpcy5ib3VuY2VWYWx1ZSwgdGhpcy5oZXJvQmFzZVkpO1xuICAgIHRoaXMubWVzaC5yb3RhdGlvbi55ID0gdGhpcy5tZXNoLnJvdGF0aW9uLnkgKyB0aGlzLnNwaW5WYWx1ZTtcblxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEhlcm87XG4iXSwic291cmNlUm9vdCI6IiJ9